@model IEnumerable<TourismManagementSystem.Models.Session>
@{
    ViewBag.Title = "All Sessions";
    var page = ViewBag.Page ?? 1;
    var totalPages = ViewBag.TotalPages ?? 1;
    var totalCount = ViewBag.TotalCount ?? Model.Count();
}

<!-- Header Start -->
<div class="container-fluid bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
        <h3 class="text-white display-3 mb-4">Sessions</h3>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Home</a></li>
            <li class="breadcrumb-item active text-white">My Sessions</li>
        </ol>
    </div>
</div>
<!-- Header End -->

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">
            All Sessions <span class="badge bg-secondary">@totalCount</span>
        </h2>
        <a class="btn btn-success" href="@Url.Action("Index", "Package")">
            <i class="bi bi-box"></i> Manage Packages
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info">No sessions created yet. Go to your package to add one.</div>
    }
    else
    {
<div class="table-responsive shadow-sm rounded">
    <table id="sessionsTable" class="table table-striped table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th>Package</th>
                <th>Start</th>
                <th>End</th>
                <th class="text-center">Capacity</th>
                <th class="text-center">Status</th>
                <th class="text-center" style="width:180px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var s in Model)
            {
                var status = s.IsCanceled ? "Canceled"
                           : s.StartDate >= DateTime.Today ? "Upcoming"
                           : "Past";

                var badgeClass = status == "Upcoming" ? "success"
                              : status == "Past" ? "secondary"
                              : "danger";

                <tr>
                    <td>@s.Package.Title</td>
                    <td>@s.StartDate.ToString("yyyy-MM-dd")</td>
                    <td>@s.EndDate.ToString("yyyy-MM-dd")</td>
                    <td class="text-center">@s.Capacity</td>
                    <td class="text-center">
                        <span class="badge bg-@badgeClass">@status</span>
                    </td>
                    <td class="text-center text-nowrap">
                        <a class="btn btn-sm btn-outline-primary"
                           href="@Url.Action("Edit", "PackageSessions", new { packageId = s.PackageId, id = s.SessionId })">
                            <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a class="btn btn-sm btn-outline-danger"
                           href="@Url.Action("Delete", "PackageSessions", new { packageId = s.PackageId, id = s.SessionId })"
                           onclick="return confirm('Are you sure you want to delete this session?');">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

        <!-- Pagination -->
        if (totalPages > 1)
        {
            <nav class="mt-3">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(page == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = page - 1 })">Prev</a>
                    </li>
                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == page ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                        </li>
                    }
                    <li class="page-item @(page == totalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = page + 1 })">Next</a>
                    </li>
                </ul>
            </nav>
        }
    }
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
}
