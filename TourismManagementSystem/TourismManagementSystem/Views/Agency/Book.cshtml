@model List<TourismManagementSystem.Models.Booking>

@{
    ViewBag.Title = "Bookings";
}

<h1>Agency Bookings</h1>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Booking ID</th>
            <th>Customer Name</th>
            <th>Package</th>
            <th>Session Date</th>
            <th>Participants</th>
            <th>Status</th>
            <th>Payment Status</th>
            <th>Approval</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var b in Model)
        {
            <tr>
                <td>@b.BookingId</td>
                <td>@b.CustomerName</td>
                <td>@b.Session.Package.Title</td>
                <td>@b.Session.StartDate.ToString("dd MMM yyyy")</td>
                <td>@b.Participants</td>
                <td>@b.Status</td>
                <td>@b.PaymentStatus</td>
                <td>
                    @if (b.IsApproved == null)
                    {
                        <span class="badge bg-warning text-dark">Pending</span>
                    }
                    else if (b.IsApproved == true)
                    {
                        <span class="badge bg-success">Approved</span>
                    }
                    else
                    {
                        <span class="badge bg-danger">Rejected</span>
                    }
                </td>
                <td>
                    @if (b.IsApproved == null)
                    {
                        using (Html.BeginForm("ApproveBooking", "Agency", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("bookingId", b.BookingId)
                            <button type="submit" class="btn btn-success btn-sm mb-1">Approve</button>
                        }
                        using (Html.BeginForm("RejectBooking", "Agency", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("bookingId", b.BookingId)
                            <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                        }
                    }
                    else
                    {
                        <em>No Actions</em>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
